# Controller

Category: Cryptography
Difficulty: Baby
Author: Jakwan Bagung

## Description

  Some search, never finding a way
  Before long, they waste away
  I found you, something told me to stay

  Flag Format: ITSEC{.*}

  Author: Jakwan Bagung

## Writeup

In this challenge we are given a single file:

    chall.py: The source code of the running service with a registration and login menu. If we successfully logged in as superadmin `thegreatestadminsinthewholeworld`, it will give us the flag. We can register as many account as we want, but none of them will grant us the admin privilege.

After completing the registration, we will given an authorization token which generated by AES CBC-MAC with null-bytes IV. This can be vulnerable because we can get the superadmin's authentication token by calculating some formula composed by half of the username.

You can find more about the vulnerability here: https://book.hacktricks.wiki/en/crypto-and-stego/cipher-block-chaining-cbc-mac-priv.html

How to get superadmin's authentication token:
1. Register new user `thegreatestadmin`, take the signature as s1
2. calculate `sinthewholeworld` XOR s1, save the result as m2s1.
3. Register new user with username m2s1. Take the signature as s32.
4. Login with auth_token as `thegreatestadminsinthewholeworld`, supply the s32 as auth_token
5. You will be successfully logged in as superadmin and flag will be given.

solve.py
```
from pwn import *


goal_user = b"thegreatestadminsinthewholeworld"
part_one = goal_user.hex()[:32]
part_two = goal_user.hex()[32:]


r = remote('localhost', 20255)
r.recvuntil(">> ")
r.sendline('1')
r.recvuntil("Username (hex): ")
r.sendline(part_one)
r.recvuntil("Password: ")
r.sendline("kodokgaming")
r.recvuntil("authentication token: ")
auth_token1 = r.recvline().strip().decode()
print(auth_token1)

part_two = xor(bytes.fromhex(auth_token1), bytes.fromhex(part_two)).hex()

r.sendline('1')
r.recvuntil("Username (hex): ")
r.sendline(part_two)
r.recvuntil("Password: ")
r.sendline("kodokgaming")
r.recvuntil("authentication token: ")
auth_token2 = r.recvline().strip().decode()
print(auth_token2)

r.sendline('2')
r.sendline('b')
r.recvuntil("Username (hex): ")
r.sendline(goal_user.hex())
r.recvuntil("Token: ")
r.sendline(auth_token2)


r.interactive()
```



Flag: ITSEC{wh3n_y0u_w1th_m3}